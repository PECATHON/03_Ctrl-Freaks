<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Customer — Order Food</title>
<style>
  :root{
    --accent:#fc8019;
    --accent-dark:#e36f0d;
    --green:#16a34a;
    --card:#fff;
    --muted:#777;
    --max-width:1200px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
    background:#fafaf9;
    color:#222;
  }

  /* header */
  header{
    background:var(--accent);
    color:white;
    padding:14px 18px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    position:sticky;
    top:0;
    z-index:40;
    box-shadow:0 3px 12px rgba(0,0,0,0.12);
  }
  .brand{font-size:20px; font-weight:700}
  .cart-toggle{
    background:var(--card);
    color:var(--accent);
    padding:8px 12px;
    border-radius:10px;
    border:none;
    font-weight:700;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .badge{
    background:#ef4444;color:white;padding:2px 7px;border-radius:999px;font-size:12px;font-weight:700;
  }

  /* layout */
  .wrap{max-width:var(--max-width);margin:24px auto;padding:0 16px;display:grid;grid-template-columns:1fr 360px;gap:20px}
  @media(max-width:980px){ .wrap{grid-template-columns:1fr} }

  /* restaurant card */
  .restaurant{
    background:var(--card);
    border-radius:12px;
    padding:14px;
    box-shadow:0 6px 20px rgba(0,0,0,0.06);
    margin-bottom:18px;
  }
  .restaurant-head{display:flex;justify-content:space-between;align-items:center;gap:12px;}
  .restaurant-name{font-size:18px;font-weight:800}
  .restaurant-meta{color:var(--muted);font-size:13px}
  .category{background:#fff6ee;border-radius:10px;padding:10px;margin-top:12px}
  .category-title{font-weight:700;margin-bottom:8px}
  .product-row{display:flex;justify-content:space-between;align-items:center;padding:8px;background:#fff;border-radius:8px;margin-bottom:8px;box-shadow:0 2px 8px rgba(0,0,0,0.04)}
  .product-left{display:flex;flex-direction:column;gap:4px;min-width:0}
  .product-name{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .product-price{font-weight:700;color:var(--green)}
  .add-btn{background:var(--accent);color:white;border:none;padding:7px 10px;border-radius:8px;cursor:pointer;font-weight:700}
  .add-btn:active{transform:scale(.99)}
  .muted{color:var(--muted);font-size:13px}

  /* cart (right column) */
  .cart{
    background:var(--card);
    border-radius:12px;
    padding:14px;
    box-shadow:0 6px 20px rgba(0,0,0,0.06);
    height: fit-content;
    position:sticky;
    top:74px;
  }
  .cart h3{margin:0 0 10px 0}
  .cart-empty{color:var(--muted);padding:18px 0}
  .cart-item{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:8px;border-radius:8px;background:#fbfbfb;margin-bottom:8px}
  .qty-controls{display:flex;gap:6px;align-items:center}
  .qty-controls button{background:#eee;border:none;padding:6px 8px;border-radius:6px;cursor:pointer}
  .remove{background:#ef4444;color:white;border:none;padding:6px 8px;border-radius:6px;cursor:pointer}

  .cart-summary{margin-top:12px;border-top:1px dashed #eee;padding-top:12px;display:flex;justify-content:space-between;align-items:center}
  .checkout{background:var(--green);color:white;padding:10px 12px;border-radius:10px;border:none;font-weight:800;cursor:pointer}
  .checkout[disabled]{opacity:.6;cursor:not-allowed}

  /* small screens adjustments */
  @media(max-width:600px){
    .product-row{flex-direction:column;align-items:flex-start;gap:8px}
    .wrap{padding:0 12px}
    header{padding:12px}
    .cart{position:static;top:auto}
  }
</style>
</head>
<body>

<header>
  <div class="brand">Foodly — Order Fresh</div>
  <button class="cart-toggle" id="cartToggleBtn" aria-expanded="false">
    Cart <span id="cartCounter" class="badge">0</span>
  </button>
</header>

<main class="wrap">
  <section id="restaurantsColumn">
    <!-- Restaurants will be rendered here -->
  </section>

  <aside class="cart" id="cartColumn" aria-live="polite">
    <h3>Your Cart</h3>
    <div id="cartContents"></div>
    <div class="cart-summary">
      <div><strong>Subtotal</strong></div>
      <div><strong>₹<span id="cartTotal">0</span></strong></div>
    </div>
    <div style="margin-top:12px">
      <button id="checkoutBtn" class="checkout" disabled>Proceed to Payment</button>
    </div>
  </aside>
</main>

<script>
/* ------------- SAMPLE approvedVendors -------------
   Replace / fill this array from your admin-approved data.
   Each product must have unique id (string/number). 
--------------------------------------------------*/
const approvedVendors = [
  {
    id: 'r1',
    restaurantName: 'Tasty Bites',
    address: 'Jammu City',
    phone: '9876543210',
    menu: [
      { category: 'Fast Food', products: [
          { id: 'r1-p1', name: 'Veg Burger', price: 129 },
          { id: 'r1-p2', name: 'French Fries', price: 89 }
      ]},
      { category: 'Beverages', products: [
          { id: 'r1-p3', name: 'Cold Coffee', price: 120 }
      ]}
    ]
  },
  {
    id: 'r2',
    restaurantName: 'Green Curry',
    address: 'Sector 4, City Center',
    phone: '9123456780',
    menu: [
      { category: 'Curries', products: [
          { id: 'r2-p1', name: 'Paneer Butter Masala', price: 220 },
          { id: 'r2-p2', name: 'Dal Makhani', price: 150 }
      ]}
    ]
  }
];

/* ------------- Utilities ------------- */
const $ = sel => document.querySelector(sel);
const escapeHtml = str => String(str)
  .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
  .replaceAll('"','&quot;').replaceAll("'",'&#039;');

/* ------------- State: cart -------------
   cart = [{ id, name, price, qty, restaurantId, restaurantName }]
----------------------------------------*/
let cart = [];

/* ------------- Render restaurants ------------- */
function renderRestaurants(){
  const col = $('#restaurantsColumn');
  col.innerHTML = ''; // clear
  approvedVendors.forEach(rest => {
    const restEl = document.createElement('article');
    restEl.className = 'restaurant';
    restEl.innerHTML = `
      <div class="restaurant-head">
        <div>
          <div class="restaurant-name">${escapeHtml(rest.restaurantName)}</div>
          <div class="restaurant-meta">${escapeHtml(rest.address)} • ${escapeHtml(rest.phone)}</div>
        </div>
        <div class="muted">Open</div>
      </div>
    `;
    // menu
    rest.menu.forEach(cat => {
      const catDiv = document.createElement('div');
      catDiv.className = 'category';
      catDiv.innerHTML = `<div class="category-title">${escapeHtml(cat.category)}</div>`;
      cat.products.forEach(prod => {
        const pRow = document.createElement('div');
        pRow.className = 'product-row';
        pRow.innerHTML = `
          <div class="product-left">
            <div class="product-name">${escapeHtml(prod.name)}</div>
            <div class="muted">₹<span>${Number(prod.price).toFixed(2)}</span></div>
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <div class="product-price">₹${Number(prod.price).toFixed(2)}</div>
            <button class="add-btn" data-prod-id="${escapeHtml(prod.id)}" data-prod-name="${escapeHtml(prod.name)}" data-prod-price="${Number(prod.price)}" data-restaurant-id="${escapeHtml(rest.id)}" data-restaurant-name="${escapeHtml(rest.restaurantName)}">Add</button>
          </div>
        `;
        catDiv.appendChild(pRow);
      });
      restEl.appendChild(catDiv);
    });

    col.appendChild(restEl);
  });
}

/* ------------- Cart helpers ------------- */
function findCartIndexById(id){
  return cart.findIndex(item => item.id === id);
}

// Add item: if exists increase qty else push new
function addToCart(item){
  const idx = findCartIndexById(item.id);
  if(idx > -1){
    cart[idx].qty += 1;
  } else {
    cart.push({...item, qty:1});
  }
  renderCart();
}

// Remove item entirely
function removeFromCart(id){
  const idx = findCartIndexById(id);
  if(idx > -1) cart.splice(idx,1);
  renderCart();
}

// Change qty (delta can be negative)
function changeQty(id, delta){
  const idx = findCartIndexById(id);
  if(idx === -1) return;
  cart[idx].qty += delta;
  if(cart[idx].qty <= 0) cart.splice(idx,1);
  renderCart();
}

/* ------------- Render cart ------------- */
function renderCart(){
  const container = $('#cartContents');
  container.innerHTML = '';
  if(cart.length === 0){
    container.innerHTML = '<div class="cart-empty">Your cart is empty. Add delicious food from restaurants.</div>';
    $('#cartTotal').textContent = '0.00';
    $('#cartCounter').textContent = '0';
    $('#checkoutBtn').disabled = true;
    return;
  }

  let total = 0;
  cart.forEach(item => {
    total += item.price * item.qty;
    const itemDiv = document.createElement('div');
    itemDiv.className = 'cart-item';
    itemDiv.innerHTML = `
      <div style="min-width:0">
        <div style="font-weight:700">${escapeHtml(item.name)}</div>
        <div class="muted" style="font-size:12px">${escapeHtml(item.restaurantName)}</div>
      </div>

      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
        <div style="font-weight:700">₹${(item.price * item.qty).toFixed(2)}</div>
        <div style="display:flex;align-items:center;gap:6px">
          <div class="qty-controls">
            <button aria-label="decrease" data-decrease="${escapeHtml(item.id)}">−</button>
            <span style="padding:0 6px">${item.qty}</span>
            <button aria-label="increase" data-increase="${escapeHtml(item.id)}">+</button>
          </div>
          <button class="remove" data-remove="${escapeHtml(item.id)}">Remove</button>
        </div>
      </div>
    `;
    container.appendChild(itemDiv);
  });

  $('#cartTotal').textContent = total.toFixed(2);
  $('#cartCounter').textContent = cart.reduce((s,i)=>s+i.qty,0);
  $('#checkoutBtn').disabled = false;
}

/* ------------- Event delegation ------------- */
document.addEventListener('click', (e) => {
  // add button
  const addBtn = e.target.closest('.add-btn');
  if(addBtn){
    const id = addBtn.dataset.prodId;
    const name = addBtn.dataset.prodName;
    const price = Number(addBtn.dataset.prodPrice);
    const restaurantId = addBtn.dataset.restaurantId;
    const restaurantName = addBtn.dataset.restaurantName;
    addToCart({ id, name, price, restaurantId, restaurantName });
    return;
  }

  // remove from cart
  const rm = e.target.closest('[data-remove]');
  if(rm){
    removeFromCart(rm.dataset.remove);
    return;
  }

  // increase
  const inc = e.target.closest('[data-increase]');
  if(inc){
    changeQty(inc.dataset.increase, +1);
    return;
  }

  // decrease
  const dec = e.target.closest('[data-decrease]');
  if(dec){
    changeQty(dec.dataset.decrease, -1);
    return;
  }
});

/* ------------- Cart toggle + checkout ------------- */
$('#cartToggleBtn').addEventListener('click', () => {
  const cartCol = $('#cartColumn');
  // on narrow screens scroll to cart
  if(window.innerWidth < 980){
    cartCol.scrollIntoView({behavior:'smooth'});
  } else {
    // highlight cart for a moment
    cartCol.animate([{boxShadow:'0 6px 20px rgba(0,0,0,0.06)'},{boxShadow:'0 10px 30px rgba(0,0,0,0.12)'}],{duration:220,iterations:1});
  }
});

$('#checkoutBtn').addEventListener('click', () => {
  if(cart.length === 0) return;
  // dummy payment flow: show a confirm with total
  const total = Number($('#cartTotal').textContent);
  const ok = confirm(`Proceed to payment for ₹${total.toFixed(2)} ?`);
  if(ok){
    // simulate checkout success
    alert('Payment successful — order placed! (This is a demo.)');
    cart = [];
    renderCart();
  }
});

/* ------------- Init ------------- */
renderRestaurants();
renderCart();

</script>
</body>
</html>
